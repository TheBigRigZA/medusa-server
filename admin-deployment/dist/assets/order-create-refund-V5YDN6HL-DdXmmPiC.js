import{a as T}from"./chunk-EA4G7XL6-TESy5_3j.js";import{f as L}from"./chunk-IR5DHEKS-aVJcUHa1.js";import{f as I}from"./chunk-OV5NMSY6-CzJZ0JaW.js";import{D as A}from"./chunk-7I5DQGWY-CwOWioty.js";import{g as N}from"./chunk-PDWBYQOW-BedvhUOI.js";import{c as w}from"./chunk-MWVM4TYO-bKUcYSnf.js";import{K as V}from"./chunk-6HTZNHPT-BHh1J_ph.js";import{b as m,u as D}from"./chunk-4TC5YS65-Be7-K7je.js";import{a4 as M,a6 as g,ah as z,b as S,U as O,aU as U,d2 as B,j as e,H,u as $,a2 as K,r as _,aa as k,ab as q,t as v,E as G,w as n,T as J,B as C}from"./index-CfUJ0SOU.js";import{a as Q}from"./chunk-FO3VP56P-Cmzfd6S7.js";import{f as W}from"./index.esm-DlTOR-LH.js";import{S as l}from"./select-Cw6JE7i6.js";import{C as X}from"./currency-input-BPfxmeIB.js";import"./chunk-7DXVXBSA-CCclXhoB.js";import"./index-DkxIcUFg.js";import"./document-text-SLOSFa2n.js";import"./arrow-down-right-mini-DLoyuyCT.js";import"./use-prompt-DMOig1IV.js";import"./prompt-DDVbPMTk.js";import"./x-circle-BY2BERIg.js";import"./Trans-BnWcEnm3.js";import"./status-badge-CUGimxAa.js";import"./format-CBdyxNb4.js";import"./triangles-mini-DArgenMa.js";import"./check-eHXE5iIX.js";var Y=M({amount:g().or(z()),refund_reason_id:g().nullish(),note:g().optional()}),Z=({order:t,refundReasons:y})=>{const{t:o}=S(),{handleSuccess:u}=D(),p=$(),[h]=K(),j=h.get("paymentId"),b=T(t),s=b.find(r=>r.id===j),R=(s==null?void 0:s.amount)||0,f=_.useMemo(()=>w[t.currency_code.toUpperCase()],[t.currency_code]),i=k({defaultValues:{amount:R,note:""},resolver:q(Y)});_.useEffect(()=>{const r=t.summary.pending_difference,a=(s==null?void 0:s.amount)||0,c=r<0?Math.min(r,a):a,x=c<0?c*-1:c;i.setValue("amount",x)},[s]);const{mutateAsync:F,isPending:E}=Q(t.id,s==null?void 0:s.id),P=i.handleSubmit(async r=>{await F({amount:parseFloat(r.amount),refund_reason_id:r.refund_reason_id,note:r.note},{onSuccess:()=>{v.success(o("orders.payment.refundPaymentSuccess",{amount:I(r.amount,s==null?void 0:s.currency_code)})),u()},onError:a=>{v.error(a.message)}})});return e.jsx(m.Form,{form:i,children:e.jsxs(V,{onSubmit:P,className:"flex size-full flex-col overflow-hidden",children:[e.jsx(m.Body,{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsxs(l,{value:s==null?void 0:s.id,onValueChange:r=>{p(`/orders/${t.id}/refund?paymentId=${r}`,{replace:!0})},children:[e.jsx(G,{className:"txt-compact-small mb-[-6px] font-sans font-medium",children:o("orders.payment.selectPaymentToRefund")}),e.jsx(l.Trigger,{children:e.jsx(l.Value,{placeholder:o("orders.payment.selectPaymentToRefund")})}),e.jsx(l.Content,{children:b.map(r=>{const a=r.refunds.reduce((c,x)=>x.amount+c,0);return e.jsxs(l.Item,{value:r.id,disabled:!!r.canceled_at||a>=r.amount,className:"flex items-center justify-center",children:[e.jsxs("span",{children:[N(r.amount,r.currency_code)," - "]}),e.jsx("span",{children:L(r.provider_id)}),e.jsxs("span",{children:[" - (#",r.id.substring(23),")"]})]},r.id)})})]}),e.jsx(n.Field,{control:i.control,name:"amount",rules:{required:!0,min:0,max:R},render:({field:{onChange:r,...a}})=>e.jsxs(n.Item,{children:[e.jsx(n.Label,{children:o("fields.amount")}),e.jsx(n.Control,{children:e.jsx(X,{...a,min:0,placeholder:W({value:"0",decimalScale:f.decimal_digits}),decimalScale:f.decimal_digits,symbol:f.symbol_native,code:f.code,value:a.value,onValueChange:(c,x,d)=>r(d!=null&&d.value?d==null?void 0:d.value:""),autoFocus:!0})}),e.jsx(n.ErrorMessage,{})]})}),e.jsx(n.Field,{control:i.control,name:"note",render:({field:r})=>e.jsxs(n.Item,{children:[e.jsx(n.Label,{children:o("fields.note")}),e.jsx(n.Control,{children:e.jsx(J,{...r})}),e.jsx(n.ErrorMessage,{})]})})]})}),e.jsx(m.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(m.Close,{asChild:!0,children:e.jsx(C,{variant:"secondary",size:"small",children:o("actions.cancel")})}),e.jsx(C,{isLoading:E,type:"submit",variant:"primary",size:"small",disabled:!!Object.keys(i.formState.errors||{}).length,children:o("actions.save")})]})})]})})},Se=()=>{const{t}=S(),y=O(),{order:o}=U(y.id,{fields:A}),{refund_reasons:u,isLoading:p,isError:h,error:j}=B();if(h)throw j;return e.jsxs(m,{children:[e.jsx(m.Header,{children:e.jsx(H,{children:t("orders.payment.createRefund")})}),o&&!p&&u&&e.jsx(Z,{order:o,refundReasons:u})]})};export{Se as Component};
